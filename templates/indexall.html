{% load static %}

<!DOCTYPE html>
<html lang="en">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="" />
    <meta name="keywords" content="" />
    <title>REFOUT</title>
    <link rel="icon" href="{% static 'images/fav.png' %}" type="image/png" sizes="16x16">
    <link rel="stylesheet" href="{% static 'css/main.min.css' %}">
    <link rel="stylesheet" href="{% static 'bootstrap/css/bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'bootstrap/js/bootstrap.min.js' %}">
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <link rel="stylesheet" href="{% static 'css/color.css' %}">
    <link rel="stylesheet" href="{% static 'css/responsive.css' %}">
    <link rel="stylesheet" href="{% static 'js/modalpost.js' %}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    <script>
        $(document).on('click', '.like-button', function(e) {
            e.preventDefault();
            var postid = $(this).val();
            var csrftoken = $('input[name=csrfmiddlewaretoken]').val();
            $.ajax({
                type: 'POST',
                url: '{% url "app:like" %}',
                data: {
                    postid: postid,
                    csrfmiddlewaretoken: csrftoken,
                    action: 'post'
                },
                success: function(json) {
                    $('#like-count-' + postid).text(json.result);
                },
                error: function(xhr, errmsg, err) {
                    // handle error
                }
            });
        });
    </script>
    <script>
        $(document).on('click', '.comment', function(e) {
            e.preventDefault();
            let postId = $(this).data("postid");
            var csrftoken = $('input[name=csrfmiddlewaretoken]').val();
            console.log(postId)

            $.ajax({
                type: 'POST',

                url: '{% url "app:post" %}', // Remove the trailing slash in the URL
                data: {
                    postid: postId, // Use the correct variable name
                    csrfmiddlewaretoken: csrftoken,
                },
                success: function(data) {
                    var imageUrl = data.image;
                    var user = data.user;
                    var created = data.created;
                    var likeCount = data.likes;
                    var profilePicture = data.profile_picture;

                    // Display the post data in the HTML document
                    // Replace the relevant HTML elements with the post data
                    $("#post-image").attr("src", imageUrl);
                    $("#post-user").text(user);
                    $("#post-created").text(created);
                    $("#post-likes").text(likeCount);
                    $("#post-profile-picture").attr("src", profilePicture);

                    // Set the modal title
                    var title = user + "'s post";
                    $('#exampleModalLongTitle').text(title);
                },
                error: function(jqXHR, textStatus, errorThrown) {
                    // Handle any errors that may occur
                    console.error("Error retrieving post data:", textStatus, errorThrown);
                }
            });
        });
    </script>



</head>

<body>
    <!--<div class="se-pre-con"></div>-->
    <div class="theme-layout">

        <div class="responsive-header">
            <div class="mh-head first Sticky">
                <span class="mh-btns-left">
				<a class="" href="#menu"><i class="fa fa-align-justify"></i></a>
			</span>
                <span class="mh-text">
				<a href="/" title=""><img src="{% static 'images/logo.png' %}" alt=""></a>
			
            </div>
            <div class="mh-head second">
                <form class="mh-form">
                    <input name="username" placeholder="search" />
                    <a href="/test" class="fa fa-search"></a>
                </form>
            </div>


        </div>
        <!-- responsive header -->

        <div class="topbar stick">
            <div class="logo">
                <a title="" href="/"><img src="{% static 'images/logo.png' %}" alt=""></a>
            </div>

            <div class="top-area">

                <ul class="setting-area">
                    <li>
                        <a href="/post"><i class="ti-plus"></i></a>
                    </li>
                    <li>
                        <a href="#" title="Home" data-ripple=""><i class="ti-search"></i></a>
                        <div class="searched">
                            <form method="POST" action="search" class="form-search">
                                {% csrf_token %}
                                <input type="text" name="username" placeholder="Search Friend">
                                <button type="submit" data-ripple><i class="ti-search"></i>S</button>
                                
                            </form>
                        </div>
                    </li>
                    <li><a href="newsfeed.html" title="Home" ><i class="ti-home"></i></a></li>
                    <li>
                        <a href="/notifications" title="Notification" >
                            <i class="ti-bell"></i>
                        </a>
                    </li>
                    <li>
                        <a href="logout" title="Logout" data-ripple="">
                            <i class="ti-close"></i>
                        </a>
                    </li>


                </ul>
                <div class="user-img">
                    <a target="_blank" href="/profile/{{user_profile.user.username}}">
                        <img src="{{user_profile.profile_picture.url}}" alt="">
                        <span class="status f-online"></span></a>

            </div>
        </div>
    </div>
    <!-- topbar -->

    <section>
        <div class="gap gray-bg">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-lg-12">
                        <div class="row" id="page-contents">
                            <div class="col-lg-3">
                                <aside class="sidebar static">


                                </aside>
                            </div>
                            <!-- sidebar -->
                            <div class="col-lg-6">
                                {% for post in posts %}
                                <div class="post">
                                    <div class="post-header">
                                        <img src="{{ post.user.profile_picture.url }}" alt="{{ post.user.username }}" class="post-user-image">
                                        <div class="post-user-info">
                                            <a href="{% url 'app:user_profile' post.user.username %}" class="post-username">{{ post.user.username }}</a>
                                            <p class="post-created">{{ post.created }}</p>
                                        </div>
                                    </div>
                                    {% if post.image %}
                                    <div class="post-image">
                                        <img src="{{ post.image.url }}" alt="Post image">
                                    </div>
                                    {% endif %}
                                </div>
                                {% endfor %}
                            </div>
                        </div>
    </section>

    <footer>
        <div class="container ">
            <div class="row ">
                <div class="col-lg-5 col-md-4 ">
                    <div class="widget ">
                        <div class="foot-logo ">
                            <div class="logo ">
                                <a href="index-2.html " title=" "><img src="{% static 'images/logo.png' %} " alt=" "></a>
                            </div>

                        </div>
                        <ul class="location ">

                            <li>
                                <i class="ti-mobile "></i>
                                <p>a27360@ead-aerbp.pt</p>
                            </li>
                        </ul>
                    </div>
                </div>

                <div class="col-lg-3 col-md-4 ">
                    <div class="widget ">
                        <div class="widget-title ">
                            <h4>Navigate</h4>
                        </div>
                        <ul class="list-style ">
                            <li><a href="about.html " title=" ">Home</a></li>
                            <li><a href="contact.html " title=" ">Notifications</a></li>
                            <li><a href="terms.html " title=" ">Profile</a></li>
                            <li><a href="# " title=" ">About us</a></li>
                        </ul>
                    </div>
                </div>

                <div class="col-lg-3 col-md-4 ">
                    <div class="widget ">
                        <div class="widget-title ">
                            <h4>download app</h4>
                        </div>
                        <ul class="colla-apps ">
                            <li><a href="https://play.google.com/store?hl=en " title=" "><i class="fa fa-android "></i>android</a></li>
                            <li><a href="https://www.apple.com/lae/ios/app-store/ " title=" "><i class="ti-apple "></i>IOS</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </footer>
    <!-- footer -->
    <div class="bottombar ">
        <div class="container ">
            <div class="row ">
                <div class="col-md-3 ">
                    <span class="copyright "><a target="_blank ">© Copyright, Fábio Antunes</a></span>

                </div>
            </div>
        </div>
    </div>
    <!-- Modal -->
    <div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">

                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                </div>
                <div class="modal-body">
                    <img id="post-image" src="" alt="">
                    <p id="post-user"></p>
                    <p id="post-created"></p>
                    <p id="post-likes"></p>
                </div>

            </div>
        </div>
    </div>




</body>

</html>